@model IEnumerable<El_Tringulito.Models.Ordenes>

@{
    ViewData["Title"] = "Órdenes";

    var ordenesParaLlevar = ((List<El_Tringulito.Models.Ordenes>)ViewBag.OrdenesParaLlevar ?? new List<El_Tringulito.Models.Ordenes>())
        .GroupBy(o => o.codigo_orden).ToList();

    var ordenesEnLugar = ((List<El_Tringulito.Models.Ordenes>)ViewBag.OrdenesEnLugar ?? new List<El_Tringulito.Models.Ordenes>())
        .GroupBy(o => o.codigo_orden).ToList();
}

<style>
    body {
        background: linear-gradient(to bottom, #2d1b00, #a66f00);
        font-family: 'Segoe UI', sans-serif;
        color: white;
    }

    .card {
        background-color: rgba(0, 0, 0, 0.3);
        border: none;
        border-radius: 20px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
        transition: transform 0.3s ease;
        margin-bottom: 30px;
    }

        .card:hover {
            transform: translateY(-5px);
        }

    .card-header {
        background-color: rgba(0, 0, 0, 0.5);
        border-radius: 20px 20px 0 0;
        font-weight: bold;
        color: white;
        border-bottom: none;
        text-align: center;
    }

    .table {
        background-color: rgba(0, 0, 0, 0.2);
        border-radius: 10px;
        border: none;
    }

        .table th, .table td {
            color: white;
            vertical-align: middle;
        }

    .table-hover tbody tr:hover {
        background-color: rgba(255, 193, 7, 0.3);
    }

    .btn {
        border-radius: 10px;
    }

        .btn:hover {
            transform: translateY(-2px);
        }

    .badge-warning {
        background-color: #ffc107;
        color: #000;
    }

    .badge-success {
        background-color: #28a745;
    }

    .badge-primary {
        background-color: #007bff;
    }

    .text-end {
        text-align: right;
    }

    .btn-group-actions {
        display: flex;
        gap: 10px;
    }
</style>

<div class="container mt-5">
    <div class="d-flex justify-content-between mb-4">
        <h1><i class="bi bi-clipboard-data me-2"></i>Órdenes</h1>
        <div>
            <a asp-controller="MesasMesero" asp-action="Index" class="btn btn-primary"><i class="bi bi-plus-circle"></i> Orden en Mesa</a>
            <a asp-controller="MesasMesero" asp-action="ParaLlevar" class="btn btn-success"><i class="bi bi-bag-plus"></i> Orden para Llevar</a>
        </div>
    </div>

    <!-- Órdenes para llevar -->
    <div class="card shadow-lg">
        <div class="card-header">
            <h3 class="mb-0"><i class="bi bi-bag-check me-2"></i>Órdenes para Llevar</h3>
        </div>
        <div class="card-body">
            @if (ordenesParaLlevar.Any())
            {
                <table class="table table-dark table-hover">
                    <thead>
                        <tr>
                            <th>Cliente</th>
                            <th>Productos</th>
                            <th>Fecha</th>
                            <th>Estado</th>
                            <th>Total</th>
                            <th class="text-end">Acciones</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var grupo in ordenesParaLlevar)
                        {
                            var primera = grupo.First();
                            <tr>
                                <td>@primera.nombre_cliente</td>
                                <td>@grupo.Count() producto(s) ordenado(s)</td>
                                <td>@primera.fecha.ToShortDateString()</td>
                                <td>
                                    <span class="badge @(primera.estado == "Pendiente" ? "badge-warning" :
                                                         primera.estado == "Entregada" ? "badge-success" : "badge-primary")">
                                        @primera.estado
                                    </span>
                                </td>
                                <td>$@(grupo.Sum(o => o.total ?? 0).ToString("F2"))</td>
                                <td class="text-end">
                                    <a asp-controller="Ordenes" asp-action="VerFactura" asp-route-id="@grupo.Key" class="btn btn-info btn-sm text-white">
                                        <i class="bi bi-receipt"></i> Ver Orden
                                    </a>

                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            }
            else
            {
                <div class="alert alert-info text-center">
                    No hay órdenes para llevar registradas
                </div>
            }
        </div>
    </div>

    <!-- Órdenes en el lugar -->
    <div class="card shadow-lg">
        <div class="card-header">
            <h3 class="mb-0"><i class="bi bi-egg-fried me-2"></i>Órdenes en el Local</h3>
        </div>
        <div class="card-body">
            @if (ordenesEnLugar.Any())
            {
                <table class="table table-dark table-hover">
                    <thead>
                        <tr>
                            <th>Mesa</th>
                            <th>Cliente</th>
                            <th>Productos</th>
                            <th>Fecha</th>
                            <th>Estado</th>
                            <th>Total</th>
                            <th class="text-end">Acciones</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var grupo in ordenesEnLugar)
                        {
                            var primera = grupo.First();
                            <tr>
                                <td>@(Convert.ToInt32(primera.id_mesa ?? 0))</td>
                                <td>@primera.nombre_cliente</td>
                                <td>@grupo.Count() producto(s) ordenado(s)</td>
                                <td>@primera.fecha.ToShortDateString()</td>
                                <td>
                                    <span class="badge @(primera.estado == "Pendiente" ? "badge-warning" :
                                                         primera.estado == "Entregada" ? "badge-success" : "badge-primary")">
                                        @primera.estado
                                    </span>
                                </td>
                                <td>$@(grupo.Sum(o => o.total ?? 0).ToString("F2"))</td>
                                <td class="text-end">
                                    <a asp-controller="Ordenes" asp-action="VerFactura" asp-route-id="@grupo.Key" class="btn btn-info btn-sm text-white">
                                        <i class="bi bi-receipt"></i> Ver Orden
                                    </a>

                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            }
            else
            {
                <div class="alert alert-info text-center">
                    No hay órdenes en el local registradas
                </div>
            }
        </div>
    </div>
</div>
